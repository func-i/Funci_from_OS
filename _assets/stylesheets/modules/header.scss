header {
  position: relative;
  -webkit-user-select: none;

  nav {
    @extend .row, .collapse;

    position: relative;
    z-index: 3;

    .selected {
      color: $green;
    }

    > ul {
      position: relative;
      z-index: 0;
      padding: 0;
      margin: 1.333em 0;
      text-align: center;

      @media screen and (max-width:640px) {
        text-align: left;
        margin: .5em 1em;
      }

      > li {
        position: relative;
        display: inline-block;
        padding: 1em 0;
        margin: 0 .75em;

        @include perspective-origin(top);
        @include perspective(200px);

        @media screen and (max-width:640px) { padding: 0; }

        > a {
          padding: 1em 0;

          @media screen and (max-width:640px) { padding: 0; }
        }

        &.menu-activated {
          > .sub-menu {
            pointer-events: all;

            > ul {
              @include transform(none);
            }
          }
        }

        @media screen and (max-width:640px) {
          display: block;
          width: 7em;
          margin: 0;

          padding: .5em 0 .5em 0;

          > a {
            padding: .5em 0 .5em 0;
          }
        }

        > .sub-menu {
          pointer-events: none;
          position: absolute;
          left: -1em;
          z-index: 5000;
          margin-top: 1em;


          @media screen and (max-width:640px) {
            left: 5em;
            top: -.6em;
            margin-top: 0;
          }

          &:hover {
            display: block;
          }

          > ul {
            background: $dark-gray;
            border: solid 1px $green;
            padding: .5em 1em;
            text-align: left;
            width: 11em;
            height: 11em;

            > li {
              position: relative;
              display: list-item;
              padding: .5em 0 .5em 0;

              > a {
                padding: .5em 0 .5em 0;
              }
            }
          }
        }
      }
    }
  }
}

.no-touch {
  header nav > ul > li > .sub-menu {
    @include transform-style(preserve-3d);
    @include transform-origin(top);
    @include transform(rotateX(-75deg));
    @include transition(all, 0.5s, ease-in-out);
    > ul {
      @include transform-style(preserve-3d);
      @include transform-origin(top);
    }
    > ul:nth-child(2) {
      opacity: 0;
      @include transition(all, 0.5s, ease-in-out);
      @include transform(rotateX(-90deg));
    }
  }
  header nav > ul > li:hover > .sub-menu {
    pointer-events: all;
    @include transform(none);
    @include transition(all, 0.5s, cubic-bezier(0,1.5,0.9,1.0));
    > ul:nth-child(2) {
      opacity: 1;
      @include transform(none);
      @include transition(all, 0.5s, cubic-bezier(0,1.5,0.9,1.0));
      @include transition-delay(0.35s);
    }
  }
}

.no-csstransforms3d {
  header nav > ul {
    > li {
      > .sub-menu {
        display: none;
      }
    }

    > li.menu-activated {
      > .sub-menu {
        display: block;
      }
    }
  }
}

.no-touch.no-csstransforms3d {
  header nav > ul > li:hover > .sub-menu {
    display: block;
  }
}

